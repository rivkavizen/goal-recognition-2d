<!DOCTYPE html>
<html>
<head>
<title>My experiment</title>
<script src="https://goal-recognition.web.app/jsPsych/jspsych.js"></script>
<script src="https://goal-recognition.web.app/jsPsych/plugins/jspsych-instructions.js"></script>
<script src="https://goal-recognition.web.app/jsPsych/plugins/jspsych-free-sort.js"></script>
<script src="https://goal-recognition.web.app/jsPsych/plugins/jspsych-html-button-response.js"></script>
<script src="https://goal-recognition.web.app/jsPsych/plugins/jspsych-survey-multi-choice.js"></script>
<link href="https://goal-recognition.web.app/jsPsych/css/jspsych.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
</head>
<body></body>
<script>

    /* create timeline */
    var timeline = [];

    const num_pictures = 15;
    const initial_delay = 5;
    const move_time = 30;

    /* define welcome message trial */
    var welcome = {
        type: "instructions",
        pages: ["<p>In the next experiment you will see " + num_pictures +
        " different pictures, one after the other</p>" +
        "<p>Each picture will contain several objects. </p>" +
        "<p>One of the objects will be flashing</p>",
        "<p>" + initial_delay + " seconds after the picture will be presented," +
        " you will be asked to move the flashing object to a position in " +
        "the picture which is most suitable place for you.</p>" +
        "<p>You will have " + move_time + " seconds to move the object." +
        " When the time will be expired, you will be asked to move to the next picture.</p>" +
        "<p>Bonus will be added to the payment if all flashing objects will be moved.</p>"],
        show_clickable_nav: true,
        show_page_number: true
    };
    timeline.push(welcome);

    add_questions();

    run_test(false, 12);
    run_test(false, 25);
    run_test(false, 46);
    run_test(false, 90);
    run_test(false, 120);
    run_test(false, 150);
    run_test(false, 170);

    var goodbye = {
        type: "html-button-response",
        stimulus: "Thank you for participating! ",
        choices: ['GoodBye!']
    };
    timeline.push(goodbye);

    /* start the experiment */
    jsPsych.init({
        timeline: timeline,

        show_progress_bar: true
    });
    
    function run_test(is_example, index) {
        var sort_trial = {
            type: 'free-sort',
            stim_path: "./svg/slide"+index+".svg",
            stim_id: "svg-" + index,
            prompt: "<p>Click and drag the image below to where you think it should be.</p>",
            button_label: "I'm done, take me to next image"
        };

        timeline.push(sort_trial);
    }

    function add_questions() {
        var quest1 = {
            type: 'html-button-response',
            stimulus: '<p>1. How Many pictures will be in the experiment?</p>',
            choices: [num_pictures, num_pictures-2, 1, num_pictures + 5],
            prompt: "<p>Choose the correct answer</p>"
            };
        var loop1 = {
            timeline: [quest1],
            loop_function: function (data) {
                console.log(typeof (data.values()[0].button_pressed));
                if (data.values()[0].button_pressed !== "0"){
                    alert('Wrong answer, please try again.');
                    return true;
                } else {
                    return false;
                }
            }
        };

        var quest2 = {
            type: 'html-button-response',
            stimulus: '<p>2. For each picture, which object should be moved?</p>',
            choices: ['The non-flashing objects in the picture',
                'All objects in the picture',
                'The flashing object in the picture'],
            prompt: "<p>Choose the correct answer</p>"
            };
        var loop2 = {
            timeline: [quest2],
            loop_function: function (data) {
                if (data.values()[0].button_pressed !== "2"){
                    alert('Wrong answer, please try again.');
                    return true;
                } else {
                    return false;
                }
            }
        };

        var quest3 = {
            type: 'html-button-response',
            stimulus: '<p>3. How much time after picture is presented you will be able to move the flashing object?</p>',
            choices: [initial_delay, 0, initial_delay + 7],
            prompt: "<p>Choose the correct answer</p>"
            };
        var loop3 = {
            timeline: [quest3],
            loop_function: function (data) {
                if (data.values()[0].button_pressed !== "0"){
                    alert('Wrong answer, please try again.');
                    return true;
                } else {
                    return false;
                }
            }
        };

        var quest4 = {
            type: 'html-button-response',
            stimulus: '<p>4. When will you get bonus?</p>',
            choices: ['If the flashing object in one of the pictures will not be moved',
                'If for all pictures, the flashing object will not be moved before moving to next picture',
                'If for all pictures, the flashing object will be moved before moving to next picture'],
            prompt: "<p>Choose the correct answer</p>"
            };
        var loop4 = {
            timeline: [quest4],
            loop_function: function (data) {
                if (data.values()[0].button_pressed !== "2"){
                    alert('Wrong answer, please try again.');
                    return true;
                } else {
                    return false;
                }
            }
        };

        timeline.push(loop1);
        timeline.push(loop2);
        timeline.push(loop3);
        timeline.push(loop4);
    }

</script>
</html>